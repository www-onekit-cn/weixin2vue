<!--#include virtual="/page/API/pages/bluetooth/bluetooth.htm"-->
<!--#include file="../../../common/head.html"-->

<!--#include file="../../../common/foot.html"-->


<wx-wxs  module="utils">
module.exports.max = function(n1, n2) {
  return Math.max(n1, n2)
}
module.exports.len = function(arr) {
  arr = arr || []
  return arr.length
}
</wx-wxs>
<wx-view  class="container">
  <template id="onekit_head"></template>
<script>

    new Vue({
        el: "#onekit_head",
        data: {title: 'bluetooth'},
        template: '#head'
    })
</script>

  <wx-view  class="page-body">
    <wx-view  class="page-section">
      <wx-view  class="page-body-info">
        <wx-view  class="devices_summary">已发现 {{devices.length}} 个外围设备：</wx-view>
        <wx-scroll-view  class="device_list" scroll-y="" scroll-with-animation="">
          <wx-view  :wx:for="devices" :data-device-id="item.deviceId" :data-name="item.name || item.localName" @bindtap="createBLEConnection" class="device_item" hover-class="device_item_hover">
            <wx-view  style="font-size: 16px; color: #333;">{{item.name}}</wx-view>
            <wx-view  style="font-size: 10px">信号强度: {{item.RSSI}}dBm ({{utils.max(0, item.RSSI + 100)}}%)</wx-view>
            <wx-view  style="font-size: 10px">UUID: {{item.deviceId}}</wx-view>
            <wx-view  style="font-size: 10px">Service数量: {{utils.len(item.advertisServiceUUIDs)}}</wx-view>
          </wx-view>
        </wx-scroll-view>
      </wx-view>

      <wx-view  class="btn-area">
        <wx-button  type="primary" @bindtap="openBluetoothAdapter">开始扫描</wx-button>
        <wx-button  @bindtap="stopBluetoothDevicesDiscovery">停止扫描</wx-button>
      </wx-view>
    </wx-view>
  </wx-view>

  <wx-view  class="connected_info" v-if="connected">
    <wx-view >
      <wx-text >已连接到 {{name}}</wx-text>
      <wx-view  class="operation">
      <wx-button  v-if="canWrite" size="mini" @bindtap="writeBLECharacteristicValue">写数据</wx-button>
      <wx-button  size="mini" @bindtap="closeBLEConnection">断开连接</wx-button>
      </wx-view>
    </wx-view>
    <wx-view  :wx:for="chs" style="font-size: 12px; margin-top: 10px;">
      <wx-view >特性UUID: {{item.uuid}}</wx-view>
      <wx-view >特性值: {{item.value}}</wx-view>
    </wx-view>
  </wx-view>
  <template id="onekit_foot"></template>
<script>

    new Vue({
        el: "#onekit_foot",
        data: {},
        template: '#foot'
    })
</script>
</wx-view>

<!--#include virtual="/OnekitWX/footer.html"-->