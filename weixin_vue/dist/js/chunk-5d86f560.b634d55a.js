(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d86f560"],{"159b":function(e,t,i){var c=i("da84"),a=i("fdbc"),o=i("17c2"),s=i("9112");for(var n in a){var r=c[n],u=r&&r.prototype;if(u&&u.forEach!==o)try{s(u,"forEach",o)}catch(v){u.forEach=o}}},"17c2":function(e,t,i){"use strict";var c=i("b727").forEach,a=i("a640"),o=i("ae40"),s=a("forEach"),n=o("forEach");e.exports=s&&n?[].forEach:function(e){return c(this,e,arguments.length>1?arguments[1]:void 0)}},"2e9b":function(e,t,i){"use strict";i.r(t);var c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("onekit-page",[i("import",{attrs:{src:"../../../common/head.vue"}}),i("import",{attrs:{src:"../../../common/foot.vue"}}),i("onekit-view",{staticClass:"container"},[i("onekit-view",{staticClass:"page-body"},[i("onekit-view",{staticClass:"page-section"},[i("onekit-view",{staticClass:"page-body-info"},[i("onekit-view",{staticClass:"devices_summary"},[e._v("已发现 "+e._s(e.devices.length)+" 个外围设备：")]),i("onekit-scroll-view",{staticClass:"device_list",attrs:{"scroll-y":"","scroll-with-animation":""}},e._l(e.devices,(function(t,c){return i("onekit-view",{staticClass:"device_item",attrs:{"data-device-id":t.deviceId,"data-name":t.name||t.localName,"hover-class":"device_item_hover"},on:{tap:e.createBLEConnection}},[i("onekit-view",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.name))]),i("onekit-view",{staticStyle:{"font-size":"10px"}},[e._v("信号强度: "+e._s(t.RSSI)+"dBm ("+e._s(e.utils.max(0,t.RSSI+100))+"%)")]),i("onekit-view",{staticStyle:{"font-size":"10px"}},[e._v("UUID: "+e._s(t.deviceId))]),i("onekit-view",{staticStyle:{"font-size":"10px"}},[e._v("Service数量: "+e._s(e.utils.len(t.advertisServiceUUIDs)))])],1)})),1)],1),i("onekit-view",{staticClass:"btn-area"},[i("onekit-button",{attrs:{type:"primary"},on:{tap:e.openBluetoothAdapter}},[e._v("开始扫描")]),i("onekit-button",{on:{tap:e.stopBluetoothDevicesDiscovery}},[e._v("停止扫描")])],1),i("onekit-view",{staticClass:"btn-area"},[i("onekit-button",{attrs:{type:"primary"},on:{":tap":e.changeMode}},[e._v(" 进去从机模式 ")])],1)],1)],1),e.connected?i("onekit-view",{staticClass:"connected_info"},[i("onekit-view",[i("onekit-text",[e._v("已连接到 "+e._s(e.name))]),i("onekit-view",{staticClass:"operation"},[e.canWrite?i("onekit-button",{attrs:{size:"mini"},on:{tap:e.writeBLECharacteristicValue}},[e._v("写数据")]):e._e(),i("onekit-button",{attrs:{size:"mini"},on:{tap:e.closeBLEConnection}},[e._v("断开连接")])],1)],1),e._l(e.chs,(function(t,c){return i("onekit-view",{staticStyle:{"font-size":"12px","margin-top":"10px"}},[i("onekit-view",[e._v("特性UUID: "+e._s(t.uuid))]),i("onekit-view",[e._v("特性值: "+e._s(t.value))])],1)}))],2):e._e()],1)],1)},a=[],o=(i("4160"),i("a15b"),i("d81d"),i("fb6a"),i("c19f"),i("b0c0"),i("d3b7"),i("25f0"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("159b"),i("711f")),s=i("79f0");function n(e,t,i){for(var c=0;c<e.length;c++)if(e[c][t]===i)return c;return-1}function r(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)}));return t.join("")}Object(o["OnekitPage"])({onShareAppMessage:function(){return{title:"蓝牙",path:"packageAPI/pages/bluetooth/bluetooth"}},data:{devices:[],connected:!1,chs:[]},onUnload:function(){this.closeBluetoothAdapter()},openBluetoothAdapter:function(){var e=this;s["a"].openBluetoothAdapter({success:function(t){console.log("openBluetoothAdapter success",t),e.startBluetoothDevicesDiscovery()},fail:function(e){10001===e.errCode&&(s["a"].showModal({title:"错误",content:"未找到蓝牙设备, 请打开蓝牙后重试。",showCancel:!1}),s["a"].onBluetoothAdapterStateChange((function(e){e&&e.available&&this.startBluetoothDevicesDiscovery()})))}})},getBluetoothAdapterState:function(){var e=this;s["a"].getBluetoothAdapterState({success:function(t){console.log("getBluetoothAdapterState",t),t.discovering?e.onBluetoothDeviceFound():t.available&&e.startBluetoothDevicesDiscovery()}})},startBluetoothDevicesDiscovery:function(){var e=this;this._discoveryStarted||(this._discoveryStarted=!0,s["a"].startBluetoothDevicesDiscovery({allowDuplicatesKey:!0,success:function(t){console.log("startBluetoothDevicesDiscovery success",t),e.onBluetoothDeviceFound()}}))},stopBluetoothDevicesDiscovery:function(){var e=this;s["a"].stopBluetoothDevicesDiscovery({complete:function(){e._discoveryStarted=!1}})},onBluetoothDeviceFound:function(){var e=this;s["a"].onBluetoothDeviceFound((function(t){t.devices.forEach((function(t){if(t.name||t.localName){var i=e.data.devices,c=n(i,"deviceId",t.deviceId),a={};-1===c?a["devices[".concat(i.length,"]")]=t:a["devices[".concat(c,"]")]=t,e.setData(a)}}))}))},createBLEConnection:function(e){var t=this,i=e.currentTarget.dataset,c=i.deviceId,a=i.name;s["a"].showLoading(),s["a"].createBLEConnection({deviceId:c,success:function(){t.setData({connected:!0,name:a,deviceId:c}),t.getBLEDeviceServices(c)},complete:function(){s["a"].hideLoading()}}),this.stopBluetoothDevicesDiscovery()},closeBLEConnection:function(){s["a"].closeBLEConnection({deviceId:this.data.deviceId}),this.setData({connected:!1,chs:[],canWrite:!1})},changeMode:function(){s["a"].navigateTo({url:"./slave/slave"})},getBLEDeviceServices:function(e){var t=this;s["a"].getBLEDeviceServices({deviceId:e,success:function(i){for(var c=0;c<i.services.length;c++)if(i.services[c].isPrimary)return void t.getBLEDeviceCharacteristics(e,i.services[c].uuid)}})},getBLEDeviceCharacteristics:function(e,t){var i=this;s["a"].getBLEDeviceCharacteristics({deviceId:e,serviceId:t,success:function(c){console.log("getBLEDeviceCharacteristics success",c.characteristics);for(var a=0;a<c.characteristics.length;a++){var o=c.characteristics[a];o.properties.read&&s["a"].readBLECharacteristicValue({deviceId:e,serviceId:t,characteristicId:o.uuid}),o.properties.write&&(i.setData({canWrite:!0}),i._deviceId=e,i._serviceId=t,i._characteristicId=o.uuid,console.log("write"),i.writeBLECharacteristicValue()),(o.properties.notify||o.properties.indicate)&&s["a"].notifyBLECharacteristicValueChange({deviceId:e,serviceId:t,characteristicId:o.uuid,state:!0})}},fail:function(e){console.error("getBLEDeviceCharacteristics",e)}}),s["a"].onBLECharacteristicValueChange((function(e){var t=n(i.data.chs,"uuid",e.characteristicId),c={};-1===t?c["chs[".concat(i.data.chs.length,"]")]={uuid:e.characteristicId,value:r(e.value)}:c["chs[".concat(t,"]")]={uuid:e.characteristicId,value:r(e.value)},s["a"].showToast({title:"收到从机数据"}),i.setData(c)}))},writeBLECharacteristicValue:function(){var e=new ArrayBuffer(1),t=new DataView(e);t.setUint8(0,19*Math.random()|0),s["a"].writeBLECharacteristicValue({deviceId:this._deviceId,serviceId:this._serviceId,characteristicId:this._characteristicId,value:e,success:function(){console.log("writeBLECharacteristicValue: 成功")},fail:function(){console.log("writeBLECharacteristicValue: 失败")},complete:function(){console.log("writeBLECharacteristicValue: 结束")}})},closeBluetoothAdapter:function(){s["a"].closeBluetoothAdapter(),this._discoveryStarted=!1}});var u=void 0,v=(i("933e"),i("5bf3"),i("2877")),d=Object(v["a"])(u,c,a,!1,null,"0daa11f2",null);t["default"]=d.exports},4160:function(e,t,i){"use strict";var c=i("23e7"),a=i("17c2");c({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},"5bf3":function(e,t,i){"use strict";var c=i("d021"),a=i.n(c);a.a},"933e":function(e,t,i){"use strict";var c=i("9ec4"),a=i.n(c);a.a},"9ec4":function(e,t,i){},a15b:function(e,t,i){"use strict";var c=i("23e7"),a=i("44ad"),o=i("fc6a"),s=i("a640"),n=[].join,r=a!=Object,u=s("join",",");c({target:"Array",proto:!0,forced:r||!u},{join:function(e){return n.call(o(this),void 0===e?",":e)}})},c19f:function(e,t,i){"use strict";var c=i("23e7"),a=i("da84"),o=i("621a"),s=i("2626"),n="ArrayBuffer",r=o[n],u=a[n];c({global:!0,forced:u!==r},{ArrayBuffer:r}),s(n)},d021:function(e,t,i){},d81d:function(e,t,i){"use strict";var c=i("23e7"),a=i("b727").map,o=i("1dde"),s=i("ae40"),n=o("map"),r=s("map");c({target:"Array",proto:!0,forced:!n||!r},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-5d86f560.b634d55a.js.map