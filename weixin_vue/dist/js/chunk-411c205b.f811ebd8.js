(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-411c205b"],{"4fa9":function(t,e,a){},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var i=a("1d80"),n=a("5899"),s="["+n+"]",o=RegExp("^"+s+s+"*"),r=RegExp(s+s+"*$"),l=function(t){return function(e){var a=String(i(e));return 1&t&&(a=a.replace(o,"")),2&t&&(a=a.replace(r,"")),a}};t.exports={start:l(1),end:l(2),trim:l(3)}},"763e":function(t,e,a){},"82f9":function(t,e,a){"use strict";var i=a("4fa9"),n=a.n(i);n.a},a9e3:function(t,e,a){"use strict";var i=a("83ab"),n=a("da84"),s=a("94ca"),o=a("6eeb"),r=a("5135"),l=a("c6b6"),c=a("7156"),u=a("c04e"),d=a("d039"),p=a("7c73"),w=a("241c").f,h=a("06cf").f,f=a("9bf2").f,v=a("58a8").trim,m="Number",b=n[m],k=b.prototype,C=l(p(k))==m,_=function(t){var e,a,i,n,s,o,r,l,c=u(t,!1);if("string"==typeof c&&c.length>2)if(c=v(c),e=c.charCodeAt(0),43===e||45===e){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+c}for(s=c.slice(2),o=s.length,r=0;r<o;r++)if(l=s.charCodeAt(r),l<48||l>n)return NaN;return parseInt(s,i)}return+c};if(s(m,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var y,g=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof g&&(C?d((function(){k.valueOf.call(a)})):l(a)!=m)?c(new b(_(e)),a,g):_(e)},I=i?w(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),E=0;I.length>E;E++)r(b,y=I[E])&&!r(g,y)&&f(g,y,h(b,y));g.prototype=k,k.constructor=g,o(n,m,g)}},ad64:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("onekit-page",[a("import",{attrs:{src:"../../../common/head.vue"}}),a("import",{attrs:{src:"../../../common/foot.vue"}}),a("onekit-view",{staticClass:"container"},[t.openid?a("onekit-view",{staticClass:"page-body"},[a("onekit-view",{staticClass:"page-section"},[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title"},[a("onekit-view",{staticClass:"weui-cell weui-cell_select"},[a("onekit-view",{staticClass:"weui-cell__hd weui-cell__hd_in-select-after"},[a("onekit-view",{staticClass:"weui-label"},[t._v("权限类型")])],1),a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-picker",{attrs:{value:t.currentPermissionIndex,range:t.permissions},on:{change:t.onPermissionChange}},[a("onekit-view",{staticClass:"weui-select permission-select",attrs:{"weui-select_in-select-after":""}},[t._v(t._s(t.permissions[t.currentPermissionIndex]))])],1)],1)],1)],1),a("onekit-view",{staticClass:"weui-panel"},[a("onekit-view",{staticClass:"weui-panel__bd"},[0===t.currentPermissionIndex?a("onekit-block",[a("onekit-view",{staticClass:"weui-tab"},[a("onekit-view",{staticClass:"weui-navbar"},t._l(t.tabs[t.currentPermissionIndex],(function(e){return a("onekit-block",[t._v('" : """ @tap="onTabClick"> '),a("onekit-view",{staticClass:"weui-navbar__title"},[t._v(t._s(e))])],1)})),1)],1)],1):t._e(),a("onekit-view",{staticClass:"weui-navbar__slider",style:"left: "+t.sliderLeft+"px; transform: translateX("+t.sliderOffset+"px); -webkit-transform: translateX("+t.sliderOffset+"px);"})],1),a("onekit-view",{staticClass:"weui-tab__panel"},[a("onekit-view",{staticClass:"weui-tab__content",attrs:{hidden:0!==t.activeTabIndex}},[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入个性签名",value:t.myWhatsUp,focus:!t.hasMyWhatsUp,"data-name":"myWhatsUp"},on:{input:t.bindInput,confirm:t.updateMyWhatsUp}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateMyWhatsUp}},[t._v("设置个性签名")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryMyWhatsUp}},[t._v("获取个性签名")])],1)],1),a("onekit-view",{staticClass:"weui-tab__content",attrs:{hidden:1!==t.activeTabIndex}},[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入个性签名",value:t.adminWhatsUp,"data-name":"adminWhatsUp"},on:{input:t.bindInput}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateAdminWhatsUp}},[t._v("设置个性签名")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryAdminWhatsUp}},[t._v("获取个性签名")])],1)],1)],1)],1),a("onekit-block",{directives:[{name:"elif",rawName:"v-elif",value:1===t.currentPermissionIndex,expression:"currentPermissionIndex === 1"}]},[a("onekit-view",{staticClass:"weui-tab"},[a("onekit-view",{staticClass:"weui-navbar"},t._l(t.tabs[t.currentPermissionIndex],(function(e){return a("onekit-block",[t._v('" : """ @tap="onTabClick"> '),a("onekit-view",{staticClass:"weui-navbar__title"},[t._v(t._s(e))])],1)})),1)],1)],1),a("onekit-view",{staticClass:"weui-navbar__slider",style:"left: "+t.sliderLeft+"px; transform: translateX("+t.sliderOffset+"px); -webkit-transform: translateX("+t.sliderOffset+"px);"})],1),a("onekit-view",{staticClass:"weui-tab__panel"},[a("onekit-view",{staticClass:"weui-tab__content",attrs:{hidden:0!==t.activeTabIndex}},[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入邮箱",value:t.myEmail,"data-name":"myEmail"},on:{input:t.bindInput}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateMyEmail}},[t._v("设置邮箱")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryMyEmail}},[t._v("获取邮箱")])],1)],1),a("onekit-view",{staticClass:"weui-tab__content",attrs:{hidden:1!==t.activeTabIndex}},[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入邮箱",value:t.adminEmail,"data-name":"adminEmail"},on:{input:t.bindInput}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateAdminEmail}},[t._v("设置邮箱")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryAdminEmail}},[t._v("获取邮箱")])],1)],1)],1)],1):t._e(),a("onekit-block",{directives:[{name:"elif",rawName:"v-elif",value:2===t.currentPermissionIndex,expression:"currentPermissionIndex === 2"}]},[a("onekit-view",[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入商品价格",value:t.product.price,"data-name":"product.price"},on:{input:t.bindInput}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateProductPrice}},[t._v("设置商品价格")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryProduct}},[t._v("获取商品价格")])],1)],1)],1),a("onekit-block",{directives:[{name:"elif",rawName:"v-elif",value:3===t.currentPermissionIndex,expression:"currentPermissionIndex === 3"}]},[a("onekit-view",[a("onekit-view",{staticClass:"weui-cells weui-cells_after-title input-area"},[a("onekit-view",{staticClass:"weui-cell weui-cell_input"},[a("onekit-view",{staticClass:"weui-cell__bd"},[a("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"请输入后台流水数据",value:t.serverData,"data-name":"serverData"},on:{input:t.bindInput}})],1)],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.updating},on:{tap:t.updateServerData}},[t._v("设置后台流水数据")]),a("onekit-button",{attrs:{loading:t.querying},on:{tap:t.queryServerData}},[t._v("获取后台流水数据")])],1)],1)],1)],1)],1)},n=[],s=(a("c975"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("ade3")),o=a("711f"),r=a("79f0"),l=getApp(),c=96;Object(o["OnekitPage"])({onShareAppMessage:function(){return{title:"权限管理",path:"page/cloud/pages/db-permission/db-permission"}},data:{openid:"",permissions:["仅创建者可写，所有人可读","仅创建者可读写","仅管理端可写，所有人可读","仅管理端可读写"],currentPermissionIndex:0,tabs:[["我的个性签名","阿白的个性签名"],["我的邮箱","阿绿的邮箱"],[],[]],activeTabIndex:0,sliderOffset:0,sliderLeft:0,querying:!1,updating:!1,hasMyWhatsUp:!1,myWhatsUp:"",adminWhatsUp:"",myEmail:"",adminEmail:"",hasProduct:!1,product:{},serverData:""},onLoad:function(){var t=this;l.globalData.openid?this.setData({openid:l.globalData.openid}):(r["a"].showLoading({title:"正在初始化..."}),l.getUserOpenIdViaCloud().then((function(e){return t.setData({openid:e}),r["a"].hideLoading(),e})).catch((function(t){console.error(t),r["a"].hideLoading(),r["a"].showModal({content:"初始化失败，请检查网络",showCancel:!1})})));var e=l.globalData,a=e.myWhatsUp,i=e.adminWhatsUp,n=e.myEmail,s=e.adminEmail;this.setData({hasMyWhatsUp:!!a,myWhatsUp:a||"",adminWhatsUp:i||"",myEmail:n||"",adminEmail:s||""}),this.initTabs()},initTabs:function(){var t=this.data.currentPermissionIndex,e=this.data.tabs[t].length,a=this;r["a"].getSystemInfo({success:function(t){a.setData({sliderLeft:(t.windowWidth/e-c)/2,sliderOffset:t.windowWidth/e*a.data.activeTabIndex})}})},onTabClick:function(t){this.setData({sliderOffset:t.currentTarget.offsetLeft,activeTabIndex:Number(t.currentTarget.id)})},onPermissionChange:function(t){var e=this.data.currentPermissionIndex,a=Number(t.detail.value);e!==a&&(this.setData({currentPermissionIndex:Number(a),activeTabIndex:0}),this.initTabs())},bindInput:function(t){var e=t.currentTarget.dataset.name;this.setData(Object(s["a"])({},e,t.detail.value))},showErrorModal:function(t,e){var a=t+"失败";e.toString().indexOf("permission denied")>=0&&(a+="：无权限操作"),r["a"].showModal({content:a,showCancel:!1})},queryOneByOpenId:function(t,e,a){var i=this,n=a.showLoading,s=a.showError;a.success,a.fail;n&&this.setData({querying:!0});var o=r["a"].cloud.database(),l=e||this.data.openid;o.collection(t).where({_openid:l}).get({success:function(t){console.log("[数据库] [查询记录] 成功: ",t);var e=t.data[0]||{};if(e._openid&&e._openid!==l){var a=new Error("database permission denied");s&&i.showErrorModal("获取",a),failCallback&&failCallback.call(i,a)}else successCallback&&successCallback.call(i,t.data[0])},fail:function(t){s&&i.showErrorModal("获取",t),console.error("[数据库] [查询记录] 失败：",t),failCallback&&failCallback.call(i,t)},complete:function(){n&&i.setData({querying:!1})}})},updateOneByOpenId:function(t,e,a,i){var n=this,s=i.showLoading,o=i.showError;i.success,i.fail;s&&this.setData({updating:!0});var l=r["a"].cloud.database();this.queryOneByOpenId(t,e||"",{success:function(i){if(i)l.collection(t).doc(i._id).update({data:a,success:function(t){console.log("[数据库] [更新记录] 成功: ",t),successCallback&&successCallback.call(n,t.stats)},fail:function(t){o&&n.showErrorModal("设置",t),console.error("[数据库] [更新记录] 失败：",t),failCallback&&failCallback.call(n,t)},complete:function(){s&&n.setData({updating:!1})}});else if(e&&e!==n.data.openid){var r=new Error("database permission denied");o&&n.showErrorModal("设置",r),failCallback&&failCallback.call(n,r),s&&n.setData({updating:!1})}else l.collection(t).add({data:a,success:function(t){console.log("[数据库] [新增记录] 成功：",t),successCallback&&successCallback.call(n,{_id:t._id})},fail:function(t){o&&n.showErrorModal("设置",t),console.error("[数据库] [新增记录] 失败：",t),failCallback&&failCallback.call(n,t)},complete:function(){s&&n.setData({updating:!1})}})},fail:function(t){o&&n.showErrorModal("设置",t),failCallback&&failCallback.call(n,t),s&&n.setData({updating:!1})}})},queryMyWhatsUp:function(){this.queryOneByOpenId("perm1","",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.whatsUp||"";r["a"].showModal({title:"获取成功",content:e?"个性签名为："+e:"个性签名为空",showCancel:!1})}})},updateMyWhatsUp:function(){var t=this,e={whatsUp:this.data.myWhatsUp};this.updateOneByOpenId("perm1","",e,{showLoading:!0,showError:!0,success:function(){l.globalData.myWhatsUp=t.data.myWhatsUp,t.setData({hasMyWhatsUp:!0}),r["a"].showModal({content:"设置成功",showCancel:!1})}})},queryAdminWhatsUp:function(){this.queryOneByOpenId("perm1","kiki",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.whatsUp||"";r["a"].showModal({title:"获取成功",content:e?"个性签名为："+e:"个性签名为空",showCancel:!1})}})},updateAdminWhatsUp:function(){var t=this,e={whatsUp:this.data.adminWhatsUp};this.updateOneByOpenId("perm1","kiki",e,{showLoading:!0,showError:!0,success:function(e){0===e.updated?r["a"].showModal({content:"设置失败：无权限操作",showCancel:!1}):(l.globalData.adminWhatsUp=t.data.adminWhatsUp,r["a"].showModal({content:"设置成功",showCancel:!1}))}})},queryMyEmail:function(){this.queryOneByOpenId("perm2","",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.email||"";r["a"].showModal({title:"获取成功",content:e?"邮箱为："+e:"邮箱为空",showCancel:!1})}})},updateMyEmail:function(){var t=this,e={email:this.data.myEmail};this.updateOneByOpenId("perm2","",e,{showLoading:!0,showError:!0,success:function(){l.globalData.myEmail=t.data.myEmail,r["a"].showModal({content:"设置成功",showCancel:!1})}})},queryAdminEmail:function(){this.queryOneByOpenId("perm2","popo",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.email||"";r["a"].showModal({title:"获取成功",content:e?"邮箱为："+e:"邮箱为空",showCancel:!1})}})},updateAdminEmail:function(){var t=this,e={email:this.data.adminEmail};this.updateOneByOpenId("perm2","popo",e,{showLoading:!0,showError:!0,success:function(){l.globalData.adminEmail=t.data.adminEmail,r["a"].showModal({content:"设置成功",showCancel:!1})}})},queryProduct:function(){this.queryOneByOpenId("perm3","admin",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.price||null;r["a"].showModal({title:"获取成功",content:null!==e?"商品价格为："+e:"商品价格暂未设置",showCancel:!1})}})},updateProductPrice:function(){var t={price:parseInt(this.data.product.price,10)};this.updateOneByOpenId("perm3","admin",t,{showLoading:!0,showError:!0,success:function(){r["a"].showModal({content:"设置成功",showCancel:!1})}})},queryServerData:function(){this.queryOneByOpenId("perm4","server",{showLoading:!0,showError:!0,success:function(t){var e=t&&t.serverData||"";r["a"].showModal({title:"获取成功",content:e?"后台流水数据为："+e:"后台流水数据为空",showCancel:!1})}})},updateServerData:function(){var t={data:this.data.serverData};this.updateOneByOpenId("perm4","server",t,{showLoading:!0,showError:!0,success:function(){r["a"].showModal({content:"设置成功",showCancel:!1})}})}});var u=void 0,d=(a("cf7b"),a("82f9"),a("2877")),p=Object(d["a"])(u,i,n,!1,null,"4ba301c2",null);e["default"]=p.exports},ade3:function(t,e,a){"use strict";function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}a.d(e,"a",(function(){return i}))},cf7b:function(t,e,a){"use strict";var i=a("763e"),n=a.n(i);n.a}}]);
//# sourceMappingURL=chunk-411c205b.f811ebd8.js.map