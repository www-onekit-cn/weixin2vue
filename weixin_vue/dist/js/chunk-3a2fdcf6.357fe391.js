(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a2fdcf6"],{"0e0b":function(t,e,a){"use strict";a.r(e),function(t){a("cb29"),a("a15b"),a("d81d"),a("b680"),a("d3b7"),a("ac1f"),a("25f0"),a("1276"),a("711f"),a("79f0");function e(t){if("number"!==typeof t||t<0)return t;var e=parseInt(t/3600,10);t%=3600;var a=parseInt(t/60,10);t=parseInt(t%60,10);var n=t;return[e,a,n].map((function(t){return t=t.toString(),t[1]?t:"0"+t})).join(":")}function n(t,e){return"string"===typeof t&&"string"===typeof e&&(t=parseFloat(t),e=parseFloat(e)),t=t.toFixed(2),e=e.toFixed(2),{longitude:t.toString().split("."),latitude:e.toString().split(".")}}function o(t){return t<1?0:t<=2?1:o(t-1)+o(t-2)}function i(t,e){t=t.toString();var a=Math.max(e-t.length,0);return new Array(a).fill(0).join("")+t}function r(t,e){var a=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),r=t.getHours(),s=t.getMinutes(),c=t.getSeconds(),l=t.getMilliseconds(),d=[a,n,o].map((function(t){i(t,2)})).join("-")+" "+[r,s,c].map((function(t){i(t,2)})).join(":");return e&&(d+="."+i(l,3)),d}function s(t,e){t=t.split("."),e=e.split(".");var a=Math.max(t.length,e.length);while(t.length<a)t.push("0");while(e.length<a)e.push("0");for(var n=0;n<a;n++){var o=parseInt(t[n],10),i=parseInt(e[n],10);if(o>i)return 1;if(o<i)return-1}return 0}t.exports={formatTime:e,formatLocation:n,fib:o,formatDateTime:r,compareVersion:s}}.call(this,a("dd40")(t))},"1a15":function(t,e,a){"use strict";var n=a("d78d"),o=a.n(n);o.a},"5acc":function(t,e,a){"use strict";var n=a("7383"),o=a.n(n);o.a},7383:function(t,e,a){},a15b:function(t,e,a){"use strict";var n=a("23e7"),o=a("44ad"),i=a("fc6a"),r=a("a640"),s=[].join,c=o!=Object,l=r("join",",");n({target:"Array",proto:!0,forced:c||!l},{join:function(t){return s.call(i(this),void 0===t?",":t)}})},b5de:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("onekit-page",[a("import",{attrs:{src:"../../../common/head.vue"}}),a("import",{attrs:{src:"../../../common/foot.vue"}}),a("onekit-view",{staticClass:"container"},[t.openid?a("onekit-view",{staticClass:"page-body"},[a("onekit-view",{staticClass:"page-section"},[a("onekit-view",{staticClass:"page-body-info"},[a("onekit-view",{staticClass:"page-body-title"},[t._v("服务端时间")]),t.serverDate?a("onekit-block",[a("onekit-block",[a("onekit-text",{staticClass:"page-body-text"},[t._v("客户端时间")]),a("onekit-text",{staticClass:"context-value"},[t._v(t._s(t.clientDateFormatted))])],1),a("onekit-block",[a("onekit-text",{staticClass:"page-body-text"},[t._v("服务端时间")]),a("onekit-text",{staticClass:"context-value"},[t._v(t._s(t.serverDateFormatted))])],1),a("onekit-block",[a("onekit-text",{staticClass:"page-body-text"},[t._v("时间差距")]),a("onekit-text",{staticClass:"context-value"},[t._v(t._s(t.delta)+" 毫秒")])],1)],1):a("onekit-block",[a("onekit-text",{staticClass:"page-body-text"},[t._v("很多时候我们希望记录数据的创建时间")]),a("onekit-text",{staticClass:"page-body-text"},[t._v("在小程序端使用 Date 对象创建的是客户端时间（可被任意修改），而非服务端时间")]),a("onekit-text",{staticClass:"page-body-text"},[t._v("这时可以使用云开发提供的 serverDate 对象，在请求被处理时会自动转换成服务端时间")])],1)],1),a("onekit-view",{staticClass:"btn-area"},[a("onekit-button",{attrs:{type:"primary",loading:t.loading},on:{tap:t.insertData}},[t._v("插入数据")])],1)],1)],1):t._e()],1)],1)},o=[],i=a("711f"),r=a("79f0"),s=a("0e0b"),c=getApp(),l="serverDate";Object(i["OnekitPage"])({onShareAppMessage:function(){return{title:"服务端时间",path:"page/cloud/pages/server-date/server-date"}},data:{openid:"",loading:!1,clientDate:null,serverDate:null,clientDateFormatted:"",serverDateFormatted:"",delta:0},onLoad:function(){var t=this;c.globalData.openid?this.setData({openid:c.globalData.openid}):(r["a"].showLoading({title:"正在初始化..."}),c.getUserOpenIdViaCloud().then((function(e){return t.setData({openid:e}),r["a"].hideLoading(),e})).catch((function(t){console.error(t),r["a"].hideLoading(),r["a"].showToast({icon:"none",title:"初始化失败，请检查网络"})})))},showError:function(){r["a"].showToast({icon:"none",title:"插入失败"})},completeTask:function(){this.setData({loading:!1})},insertOrUpdateData:function(t,e){var a=this,n=r["a"].cloud.database();t._id?n.collection(l).doc(t._id).update({data:e}).then((function(e){return a.setCompletedData(t._id),e})).catch((function(t){a.showError(),console.error("[数据库] [更新记录] 失败：",t),a.completeTask()})):n.collection(l).add({data:e}).then((function(t){return a.setCompletedData(t._id),t})).catch((function(t){a.showError(),console.error("[数据库] [新增记录] 失败：",t),a.completeTask()}))},setCompletedData:function(t){var e=this,a=r["a"].cloud.database();a.collection(l).doc(t).get().then((function(t){return e.setData({delta:Math.abs(t.data.time-e.data.clientDate),serverDate:t.data.time,clientDateFormatted:s.formatDateTime(e.data.clientDate,!0),serverDateFormatted:s.formatDateTime(t.data.time,!0)}),r["a"].showToast({title:"插入成功"}),e.completeTask(),t})).catch((function(t){e.showError(),console.error("[数据库] [查询记录] 失败：",t),e.completeTask()}))},insertData:function(){var t=this,e=r["a"].cloud.database(),a={time:e.serverDate()};this.setData({loading:!0}),e.collection(l).where({_openid:this.data.openid}).get().then((function(e){t.setData({clientDate:new Date}),console.log("[数据库] [查询记录] 成功: ",e);var n=e.data[0]||{};return t.insertOrUpdateData(n,a),e})).catch((function(e){t.showError(),console.error("[数据库] [查询记录] 失败：",e),t.completeTask()}))}});var d=void 0,u=(a("5acc"),a("1a15"),a("2877")),p=Object(u["a"])(d,n,o,!1,null,"5e86abaf",null);e["default"]=p.exports},d78d:function(t,e,a){},d81d:function(t,e,a){"use strict";var n=a("23e7"),o=a("b727").map,i=a("1dde"),r=a("ae40"),s=i("map"),c=r("map");n({target:"Array",proto:!0,forced:!s||!c},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},dd40:function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}}}]);
//# sourceMappingURL=chunk-3a2fdcf6.357fe391.js.map