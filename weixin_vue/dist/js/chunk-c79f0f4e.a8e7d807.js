(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c79f0f4e"],{"1a56":function(t,e,o){},"498a":function(t,e,o){"use strict";var i=o("23e7"),n=o("58a8").trim,a=o("c8d2");i({target:"String",proto:!0,forced:a("trim")},{trim:function(){return n(this)}})},"4d63":function(t,e,o){var i=o("83ab"),n=o("da84"),a=o("94ca"),s=o("7156"),c=o("9bf2").f,r=o("241c").f,d=o("44e7"),l=o("ad6d"),u=o("9f7f"),f=o("6eeb"),p=o("d039"),h=o("69f3").set,w=o("2626"),g=o("b622"),v=g("match"),_=n.RegExp,b=_.prototype,C=/a/g,m=/a/g,k=new _(C)!==C,y=u.UNSUPPORTED_Y,L=i&&a("RegExp",!k||y||p((function(){return m[v]=!1,_(C)!=C||_(m)==m||"/a/i"!=_(C,"i")})));if(L){var x=function(t,e){var o,i=this instanceof x,n=d(t),a=void 0===e;if(!i&&n&&t.constructor===x&&a)return t;k?n&&!a&&(t=t.source):t instanceof x&&(a&&(e=l.call(t)),t=t.source),y&&(o=!!e&&e.indexOf("y")>-1,o&&(e=e.replace(/y/g,"")));var c=s(k?new _(t,e):_(t,e),i?this:b,x);return y&&o&&h(c,{sticky:o}),c},T=function(t){t in x||c(x,t,{configurable:!0,get:function(){return _[t]},set:function(e){_[t]=e}})},D=r(_),S=0;while(D.length>S)T(D[S++]);b.constructor=x,x.prototype=b,f(n,"RegExp",x)}w("RegExp")},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,o){var i=o("1d80"),n=o("5899"),a="["+n+"]",s=RegExp("^"+a+a+"*"),c=RegExp(a+a+"*$"),r=function(t){return function(e){var o=String(i(e));return 1&t&&(o=o.replace(s,"")),2&t&&(o=o.replace(c,"")),o}};t.exports={start:r(1),end:r(2),trim:r(3)}},"5c2d":function(t,e,o){"use strict";var i=o("1a56"),n=o.n(i);n.a},"6ffe":function(t,e,o){"use strict";var i=o("de7b"),n=o.n(i);n.a},ade3:function(t,e,o){"use strict";function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(e,"a",(function(){return i}))},adf4:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("onekit-page",[o("import",{attrs:{src:"../../../common/head.vue"}}),o("import",{attrs:{src:"../../../common/foot.vue"}}),o("onekit-view",{staticClass:"container"},[o("onekit-view",{staticClass:"page-body"},[o("onekit-view",{staticClass:"page-section"},[o("onekit-view",{staticClass:"weui-cells weui-cells_after-title"},[o("onekit-view",{staticClass:"weui-cell weui-cell_input"},[o("onekit-view",{staticClass:"weui-cell__hd",staticStyle:{"margin-right":"10rpx"}},[o("onekit-icon",{attrs:{type:"search",size:"20"}})],1),o("onekit-view",{staticClass:"weui-cell__bd"},[o("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"精确搜索或使用正则表达式搜索",value:t.searchContent},on:{input:t.onInputSearchContent,confirm:t.searchTodo}})],1)],1)],1),o("onekit-view",{staticClass:"weui-cells__title"},[t._v("Todo List")]),t.openid?o("onekit-view",{staticClass:"weui-cells weui-cells_after-title"},[t._l(t.todoList,(function(e,i){return o("onekit-view",{staticClass:"weui-cell weui-cell_access",attrs:{"hover-class":"weui-cell_active","data-id":e._id},on:{tap:t.toDetail}},[o("onekit-view",{staticClass:"weui-cell__hd",staticStyle:{"margin-right":"10rpx"},attrs:{"data-id":e._id,"data-index":t.index,catchtap:"toggleComplete"}},[e.done?o("onekit-icon",{attrs:{type:"success"}}):o("onekit-icon",{attrs:{type:"circle"}})],1),o("onekit-view",{staticClass:"weui-cell__bd"},[t._v(t._s(e.description))]),o("onekit-view",{staticClass:"weui-cell__ft weui-cell__ft_in-access"})],1)})),t.todoList.length<5&&!t.filtered?o("onekit-view",{staticClass:"weui-cell weui-cell_input"},[o("onekit-view",{staticClass:"weui-cell__bd"},[o("onekit-input",{staticClass:"weui-input",attrs:{placeholder:"添加新的 Todo",value:t.newContent,focus:t.todoListFetched&&!t.todoList.length},on:{input:t.onInputNewContent,confirm:t.createTodo}})],1)],1):t._e()],2):t._e(),!t.todoList.length&&t.filtered?o("onekit-view",{staticClass:"page-body-info"},[o("onekit-text",{staticClass:"page-body-text"},[t._v("无数据")])],1):t._e()],1)],1)],1)],1)},n=[],a=(o("99af"),o("4d63"),o("ac1f"),o("25f0"),o("5319"),o("498a"),o("ade3")),s=o("6b75");function c(t){if(Array.isArray(t))return Object(s["a"])(t)}o("a4d3"),o("e01a"),o("d28b"),o("a630"),o("d3b7"),o("3ca3"),o("ddb0");function r(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}var d=o("06c5");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){return c(t)||r(t)||Object(d["a"])(t)||l()}var f=o("711f"),p=o("79f0"),h=getApp();Object(f["OnekitPage"])({onShareAppMessage:function(){return{title:"基本操作",path:"page/cloud/pages/crud/crud"}},data:{openid:"",todoListFetched:!1,todoList:[],searchContent:"",newContent:"",filtered:!1,loading:!1},onLoad:function(){var t=this;h.globalData.openid?(this.setData({openid:h.globalData.openid}),this.queryTodoList()):(p["a"].showLoading({title:"正在初始化..."}),h.getUserOpenIdViaCloud().then((function(e){return t.setData({openid:e}),p["a"].hideLoading(),t.queryTodoList(),e})).catch((function(t){console.error(t),p["a"].hideLoading(),p["a"].showToast({icon:"none",title:"初始化失败，请检查网络"})})))},onShow:function(){this.data.openid&&this.queryTodoList()},createTodo:function(){var t=this;if(!this.data.loading){var e=this.data.newContent;if(e){this.setData({loading:!0});var o=p["a"].cloud.database();o.collection("todos").add({data:{description:e,done:!1},success:function(o){t.setData({todoList:[].concat(u(t.data.todoList),[{_id:o._id,_openid:t.data.openid,description:e,done:!1}]),newContent:""}),p["a"].showToast({title:"新增记录成功"}),console.log("[数据库] [新增记录] 成功，记录 _id: ",o._id)},fail:function(t){p["a"].showToast({icon:"none",title:"新增记录失败"}),console.error("[数据库] [新增记录] 失败：",t)},complete:function(){t.setData({loading:!1})}})}}},queryTodoList:function(){var t=this;p["a"].showLoading({title:"正在查询..."});var e=p["a"].cloud.database();e.collection("todos").where({_openid:this.data.openid}).get({success:function(e){t.setData({todoListFetched:!0,todoList:e.data,filtered:!1}),console.log("[数据库] [查询记录] 成功: ",e)},fail:function(t){p["a"].showToast({icon:"none",title:"查询记录失败"}),console.error("[数据库] [查询记录] 失败：",t)},complete:function(){p["a"].hideLoading()}})},searchTodo:function(){var t=this,e=this.data.searchContent;if(e){var o=p["a"].cloud.database(),i=e,n=new RegExp("^/([sS]*)/","").exec(e);if(n){var a=n[1].trim().replace(new RegExp("s+","g"),"|");i=o.RegExp({regexp:a})}p["a"].showLoading({title:"正在查询..."}),o.collection("todos").where({_openid:this.data.openid,description:i}).get({success:function(e){t.setData({todoList:e.data,filtered:!0}),console.log("[数据库] [查询记录] 成功: ",e)},fail:function(t){p["a"].showToast({icon:"none",title:"查询记录失败"}),console.error("[数据库] [查询记录] 失败：",t)},complete:function(){p["a"].hideLoading()}})}else this.queryTodoList()},toggleComplete:function(t){var e=this;if(!this.data.loading){var o=t.currentTarget.dataset,i=(o.id,o.index),n=this.data.todoList[i];this.setData({loading:!0});var s=p["a"].cloud.database();s.collection("todos").doc(todoId).update({data:{done:!n.done},success:function(){e.setData(Object(a["a"])({},"todoList[".concat(i,"].done"),!n.done))},fail:function(t){p["a"].showToast({icon:"none",title:"更新失败"}),console.error("[数据库] [更新记录] 失败：",t)},complete:function(){e.setData({loading:!1})}})}},toDetail:function(t){t.currentTarget.dataset.id;p["a"].navigateTo({url:"/page/cloud/pages/crud-detail/crud-detail?todoId=".concat(todoId)})},onInputSearchContent:function(t){this.setData({searchContent:t.detail.value})},onInputNewContent:function(t){this.setData({newContent:t.detail.value})}});var w=void 0,g=(o("6ffe"),o("5c2d"),o("2877")),v=Object(g["a"])(w,i,n,!1,null,"3584420c",null);e["default"]=v.exports},c8d2:function(t,e,o){var i=o("d039"),n=o("5899"),a="​᠎";t.exports=function(t){return i((function(){return!!n[t]()||a[t]()!=a||n[t].name!==t}))}},de7b:function(t,e,o){}}]);
//# sourceMappingURL=chunk-c79f0f4e.a8e7d807.js.map